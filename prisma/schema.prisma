generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model Friend {
  id        String   @id @default(cuid())
  userId    String
  friendId  String
  user      User     @relation("user", fields: [userId], references: [id])
  friend    User     @relation("friend", fields: [friendId], references: [id])
  isBlocked Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id       String   @id @default(cuid())
  name     String
  username String   @unique
  email    String   @unique
  birthday DateTime
  joined   DateTime @default(now())

  avatar      String?
  bio         String?
  currentCity String? @map("current_city")
  homeTown    String? @map("home_town")
  profession  String?

  posts                 Post[]
  comments              Comment[]
  friends               Friend[]       @relation("user")
  friendOf              Friend[]       @relation("friend")
  stories               Story[]        @relation("author")
  receivedNotifications Notification[] @relation("RecipientNotifications") // Notifications I receive  
  sentNotifications     Notification[] @relation("ActorNotifications") // Notifications I caused

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Media {
  id     String  @id @default(cuid())
  url    String
  type   String
  postId String?
  post   Post?   @relation(fields: [postId], references: [id])
  story  Story?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Like {
  id        String   @id @default(cuid())
  authorId  String
  postId    String
  post      Post     @relation(fields: [postId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Comment {
  id          String   @id @default(cuid())
  content     String
  postId      String
  commentorId String
  commentor   User     @relation(fields: [commentorId], references: [id])
  post        Post     @relation(fields: [postId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Post {
  id       String    @id @default(cuid())
  content  String
  authorId String
  author   User      @relation(fields: [authorId], references: [id])
  media    Media[]
  likes    Like[]
  comments Comment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Story {
  id        String   @id @default(cuid())
  authorId  String
  author    User     @relation("author", fields: [authorId], references: [id])
  expiresAt DateTime
  mediaId   String   @unique
  media     Media    @relation(fields: [mediaId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([expiresAt])
}

enum NotificationType {
  FRIEND_REQUEST
  FRIEND_ACCEPTED
  FRIEND_POST
  POST_LIKED
  COMMENTED
  COVER_PHOTO_CHANGED
  PROFILE_PHOTO_CHANGED
  STORY
}

model Notification {
  id String @id @default(cuid())

  recipientId String
  recipient   User   @relation("RecipientNotifications", fields: [recipientId], references: [id])

  actorId String
  actor   User   @relation("ActorNotifications", fields: [actorId], references: [id])

  type    NotificationType
  message String?

  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}
